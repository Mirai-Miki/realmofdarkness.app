# realmofdarkness.app

Welcome to the realmofdarkness.app codebase! This repository contains the source code for a web application built with Django framework.

The realmofdarkness.app is a platform designed for role-playing game enthusiasts, providing a space to create and manage character sheets, chronicles, and more within the World of Darkness setting.

With this application, users can easily create and update character sheets, track their progress in various chronicles, and interact with other players in a collaborative environment.

Feel free to explore the code and contribute to the development of this exciting project!

## Known Issues

- On sheet update from another user the nickname changes to your own and clicking on the sheet will bring up a nickame error and fail to load.
- Updated sheets with a chronicle change will not automatically be added to another person's home page even if they should be able to see it.
- A character sheet is not setting the chronicle to None when a member leaves a server.
- Pressing enter when creating a new sheet should work as well
- "No Server" filter on the Dashboard is not working with sheets
- Being in a sheet when the character is deleted should redirect the user back home
- leaving a server does not automatically update a sheet you need to refresh the page

## Things to Implement

- Add a requirements text file
- Put a timer on returning Archived/Dead character to Active
- Impletment Draft/Active/Dead/Retired features more thoughroughly
- Server pages. Should include things like Settings/Exp Management/Server stats(clan stats ect)
- Make Character profiles Public (Add settings to allow what is shown)

## Required packages

- Python 3.12.1
- Django 5.0.2
- djangorestframework 3.14.0
- channels 4.0.0 (python -m pip install -U 'channels[daphne]') will install daphne as well
- channels-redis 4.2.0
- pillow 10.2.0
- requests 2.31.0
- redis 5.0.1

## Running the server

- You will need a Redis server running on the default port. Windows users can use WSL to run it.
- If you require the frontend then you can either build the frontend by running npm run build from the frontend directory. Or the recommended way while developing is npm start and that will launch the react dev page which auto updates on file saves.
- To start the server is py ./manage.py runserver 8080 (make sure you are running on 8080 for dev)

## Required Files

rod/settings.py

Replace: SECRET_KEY, API_KEY with dev versions
PATREON_WEBHOOK_SECRET and the Discord constants are currently only used for patreon webhook updates and not really needed for dev work

```py
"""
Django settings for rod project.

Generated by 'django-admin startproject' using Django 3.2.5.

For more information on this file, see
https://docs.djangoproject.com/en/3.2/topics/settings/

For the full list of settings and their values, see
https://docs.djangoproject.com/en/3.2/ref/settings/
"""

from pathlib import Path

# Build paths inside the project like this: BASE_DIR / 'subdir'.
BASE_DIR = Path(__file__).resolve().parent.parent


# Quick-start development settings - unsuitable for production
# See https://docs.djangoproject.com/en/3.2/howto/deployment/checklist/

# SECURITY WARNING: keep the secret key used in production secret!
SECRET_KEY = "SECRET_KEY"
API_KEY = "API_KEY"
PATREON_WEBHOOK_SECRET = (   "PATREON_WEBHOOK_SECRET"
)


# Discord constants
DISCORD_BOT_TOKEN = "BOT_TOKEN"
DISCORD_DEBUG_CHANNEL = "CHANNEL_ID"

# SECURITY WARNING: don't run with debug turned on in production!
DEBUG = True

ALLOWED_HOSTS = ["localhost", "127.0.0.1"]


# Application definition

INSTALLED_APPS = [
    "daphne",
    "django.contrib.auth",
    "django.contrib.contenttypes",
    "django.contrib.sessions",
    "django.contrib.messages",
    "django.contrib.staticfiles",
    "discordauth.apps.DiscordauthConfig",
    "main.apps.MainConfig",
    "haven.apps.HavenConfig",
    "chronicle.apps.ChronicleConfig",
    "bot.apps.BotConfig",
    "api.apps.ApiConfig",
    "patreon.apps.PatreonConfig",
    "channels",
    "rest_framework",
]

MIDDLEWARE = [
    "django.middleware.security.SecurityMiddleware",
    "django.contrib.sessions.middleware.SessionMiddleware",
    "django.middleware.common.CommonMiddleware",
    "django.middleware.csrf.CsrfViewMiddleware",
    "django.contrib.auth.middleware.AuthenticationMiddleware",
    "django.contrib.messages.middleware.MessageMiddleware",
    "django.middleware.clickjacking.XFrameOptionsMiddleware",
]

ROOT_URLCONF = "rod.urls"

TEMPLATES = [
    {
        "BACKEND": "django.template.backends.django.DjangoTemplates",
        "DIRS": [BASE_DIR / "frontend/build/"],
        "APP_DIRS": True,
        "OPTIONS": {
            "context_processors": [
                "django.template.context_processors.debug",
                "django.template.context_processors.request",
                "django.contrib.auth.context_processors.auth",
                "django.contrib.messages.context_processors.messages",
            ],
        },
    },
]

WSGI_APPLICATION = "rod.wsgi.application"
# Channels
ASGI_APPLICATION = "rod.asgi.application"

CHANNEL_LAYERS = {
    "default": {
        "BACKEND": "channels_redis.core.RedisChannelLayer",
        "CONFIG": {
            "hosts": [("127.0.0.1", 6379)],
        },
    },
}

CACHES = {
    "default": {
        "BACKEND": "django.core.cache.backends.redis.RedisCache",
        "LOCATION": "redis://127.0.0.1:6379",
    }
}


# Database
# https://docs.djangoproject.com/en/3.2/ref/settings/#databases

DATABASES = {
    "default": {
        "ENGINE": "django.db.backends.sqlite3",
        "NAME": BASE_DIR / "db.sqlite3",
    }
}

REST_FRAMEWORK = {
    "DEFAULT_AUTHENTICATION_CLASSES": [
        "rest_framework.authentication.SessionAuthentication",
        # Other authentication classes...
    ],
    # Other DRF settings...
}


# Password validation
# https://docs.djangoproject.com/en/3.2/ref/settings/#auth-password-validators

AUTH_PASSWORD_VALIDATORS = [
    {
        "NAME": "django.contrib.auth.password_validation.UserAttributeSimilarityValidator",
    },
    {
        "NAME": "django.contrib.auth.password_validation.MinimumLengthValidator",
    },
    {
        "NAME": "django.contrib.auth.password_validation.CommonPasswordValidator",
    },
    {
        "NAME": "django.contrib.auth.password_validation.NumericPasswordValidator",
    },
]


# Custom Auth Backend
# https://docs.djangoproject.com/en/3.0/topics/auth/customizing/#specifying-authentication-backends

AUTHENTICATION_BACKENDS = ["discordauth.backends.DiscordAuthBackend"]

# Custom User Model
# https://docs.djangoproject.com/en/2.2/topics/auth/customizing/#extending-the-existing-user-model

AUTH_USER_MODEL = "discordauth.User"

# Internationalization
# https://docs.djangoproject.com/en/3.2/topics/i18n/

LANGUAGE_CODE = "en-us"

TIME_ZONE = "UTC"

USE_I18N = True

USE_L10N = True

USE_TZ = True


# Static files (CSS, JavaScript, Images)
# https://docs.djangoproject.com/en/3.2/howto/static-files/

STATIC_URL = "/static/"

STATICFILES_DIRS = [
    BASE_DIR / "frontend/build/static/",
]

MEDIA_URL = "/media/"
MEDIA_ROOT = BASE_DIR / "media"

# Default primary key field type
# https://docs.djangoproject.com/en/3.2/ref/settings/#default-auto-field

DEFAULT_AUTO_FIELD = "django.db.models.BigAutoField"
```

discordauth/config.py

```py
settings = {
    'id': 'DISCORD_APP_ID',
    'secret': 'DISCORD_APP_SECRET',
    'scope': 'identify%20email%20guilds',
    'loginURL': 'https://discord.com/api/oauth2/authorize?client_id=CLIENT_ID&redirect_uri=http%3A%2F%2Flocalhost%3A8080%2Fauth%2Flogin%2Fsuccess%2F&response_type=code&scope=identify%20email&prompt=none',
    'redirect': 'http://localhost:8080/auth/login/success/',
    'final_redirect': 'http://localhost:3000/'
}
```
